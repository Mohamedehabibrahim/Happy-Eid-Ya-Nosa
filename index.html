<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Hotjar Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-50 text-gray-800 p-6">
  <h1 class="text-3xl font-bold mb-6 text-center">Hotjar Session Dashboard</h1>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
    <div class="bg-white p-4 rounded-2xl shadow">
      <h2 class="text-xl font-semibold mb-2">Sessions by Country</h2>
      <canvas id="countryChart"></canvas>
    </div>
    <div class="bg-white p-4 rounded-2xl shadow">
      <h2 class="text-xl font-semibold mb-2">Sessions by Device</h2>
      <canvas id="deviceChart"></canvas>
    </div>
    <div class="bg-white p-4 rounded-2xl shadow">
      <h2 class="text-xl font-semibold mb-2">New vs Returning Users</h2>
      <canvas id="userTypeChart"></canvas>
    </div>
    <div class="bg-white p-4 rounded-2xl shadow">
      <h2 class="text-xl font-semibold mb-2">Browser Usage</h2>
      <canvas id="browserChart"></canvas>
    </div>
  </div>

  <script>
    // رابط Google Sheets بصيغة CSV
    const csvURL = 'https://docs.google.com/spreadsheets/d/1meJNzgq95an4YlsRdCHsToGx1sf9js7OEWr1LFG8JMw/gviz/tq?tqx=out:csv';

    // استخدم PapaParse لقراءة البيانات
    Papa.parse(csvURL, {
      download: true,
      complete: function(results) {
        const data = results.data;

        // استخراج البيانات
        const countryData = {};
        const deviceData = {};
        const userTypeData = {};
        const browserData = {};

        // معالجة البيانات
        data.forEach(row => {
          const country = row[0]; // عمود البلد
          const device = row[1];  // عمود الجهاز
          const userType = row[2]; // عمود نوع المستخدم
          const browser = row[3]; // عمود المتصفح

          // تكرار البيانات لكل عمود
          countryData[country] = (countryData[country] || 0) + 1;
          deviceData[device] = (deviceData[device] || 0) + 1;
          userTypeData[userType] = (userTypeData[userType] || 0) + 1;
          browserData[browser] = (browserData[browser] || 0) + 1;
        });

        // رسم الرسوم البيانية
        renderChart('countryChart', Object.keys(countryData), Object.values(countryData));
        renderChart('deviceChart', Object.keys(deviceData), Object.values(deviceData));
        renderChart('userTypeChart', Object.keys(userTypeData), Object.values(userTypeData), 'pie', ['#10b981', '#f97316']);
        renderChart('browserChart', Object.keys(browserData), Object.values(browserData), 'doughnut', ['#3b82f6', '#6366f1', '#8b5cf6', '#ec4899']);
      }
    });

    // دالة لرسم الرسوم البيانية
    function renderChart(ctxId, labels, data, type = 'bar', backgroundColors = []) {
      const ctx = document.getElementById(ctxId).getContext('2d');
      new Chart(ctx, {
        type,
        data: {
          labels,
          datasets: [{
            label: '',
            data,
            backgroundColor: backgroundColors.length ? backgroundColors : 'rgba(59, 130, 246, 0.7)',
            borderRadius: 8
          }]
        },
        options: {
          responsive: true,
          plugins: { legend: { display: false } }
        }
      });
    }
  </script>
</body>
</html>
